<nav class="navbar navbar-expand-lg bg-body-tertiary">
  <div class="container-fluid">
    <a class="navbar-brand">
      <img src="assets/Green.png" class="logo-img" alt="GreenLink Logo">
    </a>

    <div class="collapse navbar-collapse">
      <ul class="navbar-nav">
        <li class="nav-item"><a class="nav-link" routerLink="/front">Home</a></li>
        <li class="nav-item"><a class="nav-link" routerLink="/about_ua">About us</a></li>
        <li class="nav-item"><a class="nav-link" routerLink="/research">Research</a></li>
        <li class="nav-item"><a class="nav-link" routerLink="/Contact us">Contact us</a></li>
      </ul>

      <button class="btn btn-primary ms-auto" routerLink="/reclogin">Logout</button>
    </div>
  </div>
</nav>

<div class="container my-5">

  <h3 class="text-center">Available Waste Requests</h3>

  <div class="text-center my-3">
    <input
      type="text"
      class="form-control"
      style="max-width: 350px; margin:auto"
      placeholder="Search by waste type or location"
      [(ngModel)]="searchText"
      (input)="filterWastes()">
  </div>

  <div class="table-responsive">
    <table class="table table-bordered table-striped">
      <thead class="table-dark">
        <tr>
          <th>Waste ID</th>
          <th>Type</th>
          <th>Qty</th>
          <th>Location</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>

      <tbody>
        <ng-container *ngFor="let data of filteredWastes">

          <tr>
            <td>{{ data._id }}</td>
            <td>{{ data.wasteType }}</td>
            <td>{{ data.quantity }}</td>
            <td>{{ data.location }}</td>

            <!-- ================= STATUS COLUMN ================= -->
            <td>

              <!-- No request yet -->
              <span *ngIf="!getRequestStatus(data._id)"
                    class="badge bg-secondary">
                Not Requested
              </span>

              <!-- Pending -->
              <span *ngIf="getRequestStatus(data._id) === 'pending'"
                    class="badge bg-warning text-dark">
                Requested
              </span>

              <!-- Accepted -->
              <span *ngIf="getRequestStatus(data._id) === 'accepted'"
                    class="badge bg-success">
                Accepted
              </span>

              <!-- Rejected -->
              <span *ngIf="getRequestStatus(data._id) === 'rejected'"
                    class="badge bg-danger">
                Rejected
              </span>

            </td>

            <!-- ================= ACTIONS ================= -->
            <td>
              <button
                mat-icon-button
                [matTooltip]="tooltips[data._id] || 'Loading...'"
                (mouseenter)="loadTooltip(data)">
                <mat-icon>info</mat-icon>
              </button>

              <button
                class="btn btn-outline-primary btn-sm ms-2"
                (click)="openRequestForm(data._id)"
                [disabled]="getRequestStatus(data._id) === 'accepted'">
                Send Request
              </button>
            </td>
          </tr>

          <!-- ================= REQUEST FORM ================= -->
          <tr *ngIf="selectedWasteId === data._id">
            <td colspan="6">
              <div class="border p-3 bg-light rounded">
                <div class="row g-2">
                  <div class="col-md-3">
                    <input
                      type="number"
                      [(ngModel)]="quantity"
                      class="form-control"
                      placeholder="Quantity">
                  </div>

                  <div class="col-md-5">
                    <input
                      type="text"
                      [(ngModel)]="address"
                      class="form-control"
                      placeholder="Address">
                  </div>

                  <div class="col-md-2">
                    <select [(ngModel)]="transportation" class="form-control">
                      <option value="Yes">Yes</option>
                      <option value="No">No</option>
                    </select>
                  </div>

                  <div class="col-md-2 d-flex">
                    <button
                      class="btn btn-success me-2"
                      (click)="submitRequest()">
                      Send
                    </button>

                    <button
                      class="btn btn-danger"
                      (click)="selectedWasteId = null">
                      Cancel
                    </button>
                  </div>
                </div>
              </div>
            </td>
          </tr>

        </ng-container>
      </tbody>
    </table>
  </div>
</div>
